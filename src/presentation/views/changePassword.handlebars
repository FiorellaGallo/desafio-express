<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
    </head>
    <body>
<form id="changePassword" action="">
  <label for="texto">Type your new password here:</label>
  <input type="password" id="password" name="password">
  <input type="password" id="confirmPassword" name="password">
  <button type="submit">Confirm changes</button>
</form>

        
    </body>
</html>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Obtener el token del query param
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    // Obtener el formulario y el botón del DOM
    const form = document.getElementById('changePassword');
    const submitButton = form.querySelector('button[type="submit"]');

    // Agregar el evento submit al formulario
    form.addEventListener('submit', (event) => {
      event.preventDefault(); // Evitar que el formulario se envíe por defecto

      // Validar que el token esté presente antes de hacer la llamada a la API
      if (token) {
        // Obtener los valores de los campos de contraseña
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // Realizar una llamada a la API para cambiar la contraseña usando el token en el header de autorización
        fetch('/api/email/changeUserPassword', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`, // Colocar el token en el header de autorización
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ password, confirmPassword })
        })
        .then(response => {
          // Manejar la respuesta de la API aquí
          if (response.ok) {
            // La contraseña ha sido cambiada exitosamente
            console.log('Contraseña cambiada con éxito.');
          } else {
            // Hubo un error en la solicitud a la API
            console.error('Error al cambiar la contraseña.');
          }
        })
        .catch(error => {
          console.error('Error en la solicitud a la API:', error);
        });
      } else {
        console.error('Token no encontrado en el query param.');
      }
    });
  });
</script>
